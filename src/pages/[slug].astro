---
import fetchApi from '../lib/strapi';
import type Article from '../interfaces/article';
// import { Markdown } from '@astropub/md';
import ReactMarkdown from '../components/ReactMarkdown';
import BaseLayout from '../layouts/BaseLayout.astro';
import { Image } from 'astro:assets';

export async function getStaticPaths() {
  const articles = await fetchApi<Article[]>({
		endpoint: 'articles?populate[cover][populate]=true&sort[0]=createdAt:desc',
    wrappedByKey: 'data',
  });

  return articles.map((article) => ({
    params: { slug: article.attributes.slug },
    props: article,
  }));
}
type Props = Article;

const article = Astro.props;
---
<style>
	main {
		display: flex;
		justify-content: center;
	}
	.container {
		max-width: 700px;
	}
	.cover {
		width: 100%;
		aspect-ratio: 3/2;
	}
	.content img {
		width: 100%;
	}
</style>
<BaseLayout pageTitle={article.attributes.title}>
	<main>
		<div class="container">
			{ article.attributes.cover.data &&
				<Image
					src={ article.attributes.cover.data.attributes.formats.medium.url }
					width={ article.attributes.cover.data.attributes.formats.medium.width }
					height={ article.attributes.cover.data.attributes.formats.medium.height }
					alt={article.attributes.title}
					loading="preload"
					style={{ width: '100%', aspectRatio: '3/2', height: 'auto', objectFit: 'cover' }}
				/>
			}
			<div class="content">
				<ReactMarkdown content={article.attributes.content} />
			</div>
		</div>
	</main>
</BaseLayout>
